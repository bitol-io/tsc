# RFC 0030: Support Map Property Type

**Champion:** Jochen Christ

**Authors:** Jochen Christ

**Slack:** #odcs-rfcs

## Summary

Add native support for map (also known as dictionary or key-value) structures in ODCS by extending `logicalType: object` with `keys` and `values` properties. This enables data contracts to accurately represent map/dictionary structures commonly found in modern data platforms like Databricks, Snowflake, BigQuery, Spark, and Avro-based systems.

## Motivation

Many contemporary data platforms natively support map data structures that allow storing collections of key-value pairs within a single column:

**Databricks:**
```sql
CREATE TABLE example (
    metadata MAP<STRING, STRING>,
    metrics MAP<STRING, INT>
);
```

**Snowflake:**
```sql
CREATE TABLE example (
    metadata MAP(VARCHAR, VARCHAR),
    metrics MAP(VARCHAR, NUMBER)
);
```

**BigQuery:**
```sql
CREATE TABLE example (
    metadata MAP<STRING, STRING>,
    metrics MAP<STRING, INT64>
);
```

**Apache Spark:**
```python
from pyspark.sql.types import MapType, StringType, IntegerType

schema = StructType([
    StructField("metadata", MapType(StringType(), StringType())),
    StructField("metrics", MapType(StringType(), IntegerType()))
])
```

**Apache Avro:**
```json
{
  "type": "map",
  "values": "string"
}
```

Currently, ODCS lacks native support for maps. This gap forces users to either:
1. Represent maps as `object` type, losing key/value type information
2. Use `customProperties` to store map metadata, which is non-standard and not interoperable

The Data Contract Specification (DCS) already supports maps with `type: map`, `keys`, and `values` properties, demonstrating a proven design pattern we can adopt.

## Design and Examples

### Example Usage

**Simple map (string to string):**
```yaml
schema:
  - name: users
    properties:
      - name: user_preferences
        logicalType: object
        physicalType: "MAP<STRING, STRING>"
        description: "User preference key-value pairs"
        keys:
          logicalType: string
          description: "Preference name"
        values:
          logicalType: string
          description: "Preference value"
```

**Map with numeric values:**
```yaml
schema:
  - name: metrics
    properties:
      - name: daily_counts
        logicalType: object
        physicalType: "MAP<STRING, INT>"
        description: "Daily metric counts by metric name"
        keys:
          logicalType: string
        values:
          logicalType: integer
          logicalTypeOptions:
            minimum: 0
```

**Map with complex struct values:**
```yaml
schema:
  - name: orders
    properties:
      - name: product_details
        logicalType: object
        physicalType: "MAP<STRING, STRUCT>"
        description: "Product details by product ID"
        keys:
          logicalType: string
          description: "Product ID"
        values:
          logicalType: object
          description: "Product detail structure"
          properties:
            - name: name
              logicalType: string
            - name: price
              logicalType: number
            - name: quantity
              logicalType: integer
```

**Map with array values:**
```yaml
schema:
  - name: analytics
    properties:
      - name: tag_scores
        logicalType: object
        physicalType: "MAP<STRING, ARRAY<DOUBLE>>"
        description: "Score arrays by tag name"
        keys:
          logicalType: string
        values:
          logicalType: array
          items:
            logicalType: number
```

**Comparison: Regular object vs Map:**
```yaml
# Regular object with known fields (uses 'properties')
- name: address
  logicalType: object
  properties:
    - name: street
      logicalType: string
    - name: city
      logicalType: string

# Map with dynamic keys (uses 'keys' and 'values')
- name: metadata
  logicalType: object
  keys:
    logicalType: string
  values:
    logicalType: string
```

## Alternatives

### 1. Add a new `map` logical type
```yaml
logicalType: map
keys:
  logicalType: string
values:
  logicalType: string
```
**Rejected because:** Adds a new type to the enum, which is a larger schema change. Maps are conceptually a variant of objects (with dynamic rather than static keys), so extending `object` is more natural.


### 2. Encode map in physicalType only
Store the map structure only in `physicalType` (e.g., `MAP<STRING, INT>`) without logical-level support.
**Rejected because:** This loses semantic meaning at the logical level and makes cross-platform translation difficult.

### 3. Use customProperties (current workaround)
```yaml
logicalType: object
customProperties:
  - property: mapKeyType
    value: string
  - property: mapValueType
    value: integer
```
**Rejected because:** This is non-standard, not validated by schema, and requires custom parsing logic.

## Decision

*The decision made by the TSC.*


## References

- [Apache Avro - Maps](https://avro.apache.org/docs/current/spec.html#Maps)
- [Apache Spark - MapType](https://spark.apache.org/docs/latest/sql-ref-datatypes.html)
- [Databricks - Complex Types](https://docs.databricks.com/en/sql/language-manual/sql-ref-datatypes.html#map-type)
- [Snowflake - MAP Data Type](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#map)
- [BigQuery - MAP Type](https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types#map_type)
